[Mesh]
  [gmg]
    type = GeneratedMeshGenerator
    dim = 2
    nx = 80
    ny = 160
    xmax = 200
    ymax = 300
    ymin = -100
  []
[]

[AuxVariables]
  [ls]
    order = FIRST
    family = LAGRANGE
  []
[]

[AuxKernels]
  [spheres_aux]
    type = FunctionAux
    variable = ls
    function = ls_func
    execute_on = initial
  []
[]

[Functions]
  # [ls_func]
  #   type = LevelSetOlssonSpheres
  #   # x_coords = '96.7630794242333	82.6633164224165	77.1339975981746	98.4218750715059	88.1926352466584	65.7988940084787	68.9782523324178	106.577620337263	116.806860162110	77.9633954218109	96.2101475418092	49.3491705063590	59.7166433018126	56.8137509190856	92.0631584236277	112.936336985141	66.7665248027210	35.5258734457542	44.6492495057534	62.8960016257517	90.2661298057491	114.733365603020	124.962605427867	26.1260314445430	38.7052317696933	79.8986570102955	108.098183013929	134.915379311502	140.168232194532	132.012486928775	131.874253958169	62.0666038021154	90.8190616881733	46.8609770354502	153.438597372713	127.174332957564	152.609199549077	119.018587691807	101.877699336657	122.197946015746	141.688794871199	153.991529255137	161.317876697258	142.656425665441	169.473621963014	162.700206403318	175.970571581499	147.218113695441	173.205912169378	175.141173757862	81.2809867163560	189.793868642103	167.261894433318	102.568864189687	76.1663668039323	45.7551132706018	137.956504664836	56.3990520072674	192.834993995436	81.9721515693862	190.623266465740	162.423740462106	117.359792044534	184.126316847255	17.5555872669681	26.5407303563611	31.5171172981789	16.1732575609076	37.3229020636329	35.3876404751482	99.9424377481724	19.6290818260588	14.0997630018169	1.93526158848467	62.2048367727214	15.7585586490894	37.8758339460571	87.0867714818100	134.500680399684	110.586376484838	3.31759129454514	157.585586490894	181.499890405741	66.6282918321150	3.59405723575724	0	12.9938992369685	15.8967916196955	0.276465941212095	50.3168013006013	38.9816977109054	176.108804552105	20.4584796496951	153.715063313925	175.417639699074	192.005596171800	0.138232970606048	0.967630794242333	193.526158848467	96.7630794242333	82.6633164224165	77.1339975981746	98.4218750715059	88.1926352466584	65.7988940084787	68.9782523324178	106.577620337263	116.806860162110	77.9633954218109	96.2101475418092	49.3491705063590	59.7166433018126	56.8137509190856	92.0631584236277	112.936336985141	66.7665248027210	35.5258734457542	44.6492495057534	62.8960016257517	90.2661298057491	114.733365603020	124.962605427867	26.1260314445430	38.7052317696933	79.8986570102955	108.098183013929	134.915379311502	140.168232194532	132.012486928775	131.874253958169	62.0666038021154	90.8190616881733	46.8609770354502	153.438597372713	127.174332957564	152.609199549077	119.018587691807	101.877699336657	122.197946015746	141.688794871199	153.991529255137	161.317876697258	142.656425665441	169.473621963014	162.700206403318	175.970571581499	147.218113695441	173.205912169378	175.141173757862	81.2809867163560	189.793868642103	167.261894433318	102.568864189687	76.1663668039323	45.7551132706018	137.956504664836	56.3990520072674	192.834993995436	81.9721515693862	190.623266465740	162.423740462106	117.359792044534	184.126316847255	17.5555872669681	26.5407303563611	31.5171172981789	16.1732575609076	37.3229020636329	35.3876404751482	99.9424377481724	19.6290818260588	14.0997630018169	1.93526158848467	62.2048367727214	15.7585586490894	37.8758339460571	87.0867714818100	134.500680399684	110.586376484838	3.31759129454514	157.585586490894	181.499890405741	66.6282918321150	3.59405723575724	0	12.9938992369685	15.8967916196955	0.276465941212095	50.3168013006013	38.9816977109054	176.108804552105	20.4584796496951	153.715063313925	175.417639699074	192.005596171800	0.138232970606048	0.967630794242333	193.526158848467'
  #   # y_coords = '96.7630794242333	83.6309472166588	101.739466366051	79.2074921572653	66.4900588615089	87.3632374230221	68.9782523324178	64.4165643024182	86.1191406875677	50.0403353593892	50.5932672418134	77.1339975981746	53.0814607127223	103.812960925142	121.645014133322	107.545251131505	122.197946015746	95.7954486299910	58.7490125075702	32.7612140336333	34.6964756221180	44.7874824763594	66.4900588615089	69.8076501560541	39.2581636521175	20.1820137084830	20.3202466790890	51.0079661536316	80.3133559221137	102.983563101505	31.5171172981789	6.08225070666610	8.98514308939310	21.7025763851495	61.2372059784791	16.4497235021197	37.8758339460571	128.418429693018	0.414698911818143	1.38232970606048	15.4820927078773	99.3895058657482	80.0368899809016	122.197946015746	49.0727045651469	16.3114905315136	67.1812237145392	0	33.3141459160575	92.8925562472640	0.138232970606048	49.2109375357530	120.400917397867	145.835783989380	137.818271694229	121.645014133322	147.909278548471	142.656425665441	81.1427537457500	156.479722726046	109.756978661202	143.347590518471	160.903177785439	20.0437807378769	47.5521418884804	115.700996397262	19.6290818260588	89.0220330702947	0.691164853030238	138.094737635442	165.188399874227	29.9965546215123	104.365892807566	75.4752019509020	163.667837197560	133.533049605442	159.382615108773	177.214668316953	173.620611081196	186.752743288770	117.083326103322	164.082536109379	137.680038723623	184.817481700286	33.8670777984817	95.9336816005971	12.5792003251503	154.820927078773	55.4314212130251	172.791213257560	179.011696934832	157.032654608470	175.970571581499	186.061578435740	177.076435346347	0	166.432496609681	186.890976259376	164.220769079985	96.7630794242333	83.6309472166588	101.739466366051	79.2074921572653	66.4900588615089	87.3632374230221	68.9782523324178	64.4165643024182	86.1191406875677	50.0403353593892	50.5932672418134	77.1339975981746	53.0814607127223	103.812960925142	121.645014133322	107.545251131505	122.197946015746	95.7954486299910	58.7490125075702	32.7612140336333	34.6964756221180	44.7874824763594	66.4900588615089	69.8076501560541	39.2581636521175	20.1820137084830	20.3202466790890	51.0079661536316	80.3133559221137	102.983563101505	31.5171172981789	6.08225070666610	8.98514308939310	21.7025763851495	61.2372059784791	16.4497235021197	37.8758339460571	128.418429693018	0.414698911818143	1.38232970606048	15.4820927078773	99.3895058657482	80.0368899809016	122.197946015746	49.0727045651469	16.3114905315136	67.1812237145392	0	33.3141459160575	92.8925562472640	0.138232970606048	49.2109375357530	120.400917397867	145.835783989380	137.818271694229	121.645014133322	147.909278548471	142.656425665441	81.1427537457500	156.479722726046	109.756978661202	143.347590518471	160.903177785439	20.0437807378769	47.5521418884804	115.700996397262	19.6290818260588	89.0220330702947	0.691164853030238	138.094737635442	165.188399874227	29.9965546215123	104.365892807566	75.4752019509020	163.667837197560	133.533049605442	159.382615108773	177.214668316953	173.620611081196	186.752743288770	117.083326103322	164.082536109379	137.680038723623	184.817481700286	33.8670777984817	95.9336816005971	12.5792003251503	154.820927078773	55.4314212130251	172.791213257560	179.011696934832	157.032654608470	175.970571581499	186.061578435740	177.076435346347	0	166.432496609681	186.890976259376	164.220769079985'
  #   # z_coords = '0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0'
  #   # radius = '10.2953040315569	8.97033493966052	9.94019197326165	7.33404909439047	8.93559775728730	8.28093257406750	10.3646109066520	9.51173635197038	12.2913276157625	10.3928643539746	7.73293082129832	10.8785214181266	8.00957544309625	10.4146329352676	14.8905181244933	9.12471534756965	10.4033313017664	12.2916248285026	7.96981613986048	12.5086461819730	9.19834460382870	11.6653901932737	8.93240559977935	13.4614198724294	12.3863936144886	8.62774660971605	13.6584196725057	9.44112113470007	11.6132162255477	10.3557545632293	9.99025502067916	14.0619898248159	6.92276536851671	6.96510825048141	11.6237616499681	5.67287246907205	11.6433108054951	12.6140329236006	7.02719533195319	9.93494785624711	8.80247418996230	11.8653585763562	8.73346351555447	11.6075775900967	8.47139071412360	12.1547970365269	10.7456271958086	7.62822364710139	7.69780764109646	10.1132975044052	6.04390133429583	11.8314945123646	12.9529174213198	11.3226954227294	7.70505121079784	10.4809710870240	14.4754129212137	12.5153609734555	11.0915954933962	11.7482276911934	12.6868290092328	10.3841509016226	9.78696780949448	9.46044695278758	10.3230634874062	9.53544400970606	8.47176837492685	8.14068314134967	11.2157342438804	8.86977814765508	8.11764225261589	7.25732626850149	7.25287023495254	11.3732172680504	9.27189084580264	11.2381021051481	12.4308098978008	9.46634021384964	11.4509048208271	15.7919033412392	9.32926541227627	10.8952192864456	9.38905321766989	12.2338958389374	9.19955341022304	9.16569382643993	11.3259585802242	9.95649445350609	8.63072574317989	5.66636574866726	7.18426079813173	8.91868534086599	11.5766268702880	11.3978531441985	11.0923741513720	12.0556477672041	9.60125851365850	10.7631425276729	9.87629149378185	10.2953040315569	8.97033493966052	9.94019197326165	7.33404909439047	8.93559775728730	8.28093257406750	10.3646109066520	9.51173635197038	12.2913276157625	10.3928643539746	7.73293082129832	10.8785214181266	8.00957544309625	10.4146329352676	14.8905181244933	9.12471534756965	10.4033313017664	12.2916248285026	7.96981613986048	12.5086461819730	9.19834460382870	11.6653901932737	8.93240559977935	13.4614198724294	12.3863936144886	8.62774660971605	13.6584196725057	9.44112113470007	11.6132162255477	10.3557545632293	9.99025502067916	14.0619898248159	6.92276536851671	6.96510825048141	11.6237616499681	5.67287246907205	11.6433108054951	12.6140329236006	7.02719533195319	9.93494785624711	8.80247418996230	11.8653585763562	8.73346351555447	11.6075775900967	8.47139071412360	12.1547970365269	10.7456271958086	7.62822364710139	7.69780764109646	10.1132975044052	6.04390133429583	11.8314945123646	12.9529174213198	11.3226954227294	7.70505121079784	10.4809710870240	14.4754129212137	12.5153609734555	11.0915954933962	11.7482276911934	12.6868290092328	10.3841509016226	9.78696780949448	9.46044695278758	10.3230634874062	9.53544400970606	8.47176837492685	8.14068314134967	11.2157342438804	8.86977814765508	8.11764225261589	7.25732626850149	7.25287023495254	11.3732172680504	9.27189084580264	11.2381021051481	12.4308098978008	9.46634021384964	11.4509048208271	15.7919033412392	9.32926541227627	10.8952192864456	9.38905321766989	12.2338958389374	9.19955341022304	9.16569382643993	11.3259585802242	9.95649445350609	8.63072574317989	5.66636574866726	7.18426079813173	8.91868534086599	11.5766268702880	11.3978531441985	11.0923741513720	12.0556477672041	9.60125851365850	10.7631425276729	9.87629149378185'
  #   # epsilon = 3
  #   # point = '0 0 0'
  #   # normal = '0 -1 0'
  #   x_coords = '100'
  #   y_coords = '100'
  #   z_coords = '0'
  #   radius = '30'
  #   epsilon = 3
  #   point = '0 0 0'
  #   normal = '0 -1 0'
  # []

  [ls_func]
    type = LevelSetOlssonSpheres
    # x_coords = '100 100 100'
    # y_coords = '200 110 10'
    # z_coords = '0 0'
    x_coords = '300 300 300'
    y_coords = '200 110 10'
    z_coords = '0 0'
    radius = '30 40 35'
    epsilon = 3
    point = '0 -50 0'
    normal = '0 -1 0'
  []
  # [ls_func]
  #   type = LevelSetOlssonSpheres
  #   x_coords = '100'
  #   y_coords = '100'
  #   z_coords = '0'
  #   radius = '30'
  #   epsilon = 3
  #   point = '0 0 0'
  #   normal = '0 -1 0'
  # []
[]

[AuxVariables]
  [refractive_index]
    [InitialCondition]
      type = FunctionIC
      function = '0'
    []
  []
  [deposition]
    order = CONSTANT
    family = MONOMIAL
  []
  [ls]
    [InitialCondition]
      type = FunctionIC
      function = ls_func
    []
  []
[]

[RayBCs]
  [kill]
    type = KillRayBC
    boundary = 'top right bottom left'
  []
[]

[RayKernels]
  [refraction]
    type = LaserReflectionRayKernel
    phase = ls
    refractive_index = ls
  []
  [deposition]
    type = LaserDepositionRayKernel
    variable = deposition
    depends_on = refraction
    phase = ls
  []
[]

[UserObjects/study]
  type = LaserRayStudy
  execute_on = TIMESTEP_BEGIN

  vertex_to_vertex = false
  centroid_to_vertex = false
  centroid_to_centroid = false

  always_cache_traces = true
  data_on_cache_traces = true
[]

# [UserObjects/study]
#   type = RepeatableRayStudy
#   names = 'ray_1'
#   start_points = '90 300 0'
#   #end_points = '5 5 0'
#   directions = '0 -1 0'
#   execute_on = TIMESTEP_BEGIN

#   # Needed to cache trace information for RayTracingMeshOutput
#   always_cache_traces = true
#   # Needed to cache Ray data for RayTracingMeshOutput
#   data_on_cache_traces = true
# []

# [UserObjects/study]
#   type = ConeRayStudy

#   start_points = '100 300 0'
#   directions = '0 -1 0'
#   half_cone_angles = 30
#   ray_data_name = weight

#   azimuthal_quad_orders = 100

#   # Must be set with RayKernels that
#   # contribute to the residual
#   execute_on = TIMESTEP_BEGIN

#   # For outputting Rays
#   always_cache_traces = true
#   data_on_cache_traces = true
# []

[Executioner]
  type = Steady
[]

[Problem]
  solve = false
[]

[Outputs]
  exodus = true
  csv = true
  [rays]
    type = RayTracingExodus
    study = study
    execute_on = TIMESTEP_END
  []
[]
